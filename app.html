<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clube dos GPTs</title>
  <link rel="stylesheet" href="css/styles.css">

  <!-- ==== Proteção de Acesso via Supabase ==== -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL      = 'https://fouqnyydrhxgadnxjtds.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZvdXFueXlkcmh4Z2FkbnhqdGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NjQyNDUsImV4cCI6MjA2ODA0MDI0NX0.JH2SFA-6itPBy_Vdnqm9wCmIw7m3BPHRlZkfcgaP-is'; // a mesma key que usa no index

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    (async () => {
      // 1. Checa se o usuário está autenticado
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        window.location.href = 'index.html';
        return;
      }

      // 2. Checa se é membro ativo
      const email = session.user.email.trim().toLowerCase();
      const { data: member } = await supabase
        .from('members')
        .select('plan_status')
        .ilike('email', email)
        .maybeSingle();

      if (member?.plan_status !== 'ativo') {
        await supabase.auth.signOut();
        alert('Acesso restrito a membros ativos.');
        window.location.href = 'index.html';
        return;
      }

      // Se passou, pode exibir a página normalmente
    })();
  </script>
  <!-- ========================================== -->
</head>
<body>
  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar">
    <ul class="menu">
      <li data-section="gpts" class="active">
        <span class="icon">🤖</span>
        <span class="label">GPTs</span>
      </li>
      <li data-section="favoritos">
        <span class="icon">★</span>
        <span class="label">Favoritos</span>
      </li>
      <li data-section="sugestoes">
        <span class="icon">✉️</span>
        <span class="label">Sugestões</span>
      </li>
      <li data-section="manual">
        <span class="icon">📖</span>
        <span class="label">Manual</span>
      </li>
      <li data-section="cadastro">
        <span class="icon">📝</span>
        <span class="label">Cadastro</span>
      </li>
      <li data-section="sair">
        <span class="icon">🚪</span>
        <span class="label">Sair</span>
      </li>
    </ul>
  </aside>

  <!-- BOTÃO DE COLAPSO -->
  <button id="collapseBtn" class="collapse-btn" aria-label="Toggle sidebar">‹</button>

  <!-- HEADER FIXO -->
  <header class="topbar">
    <img src="logo-placeholder.png" alt="Logo do Clube" class="header-logo">
    <div class="titles">
      <h1 class="logo">Clube dos GPTs</h1>
      <p class="tagline">Explore e aproveite!</p>
    </div>
  </header>

  <!-- BARRA DE BUSCA + TABS FIXA -->
  <div id="searchTabs" class="search-tabs">
    <div class="inner">
      <div class="search-bar">
        <div class="input-wrapper">
          <input id="searchInput" type="text" placeholder="Pesquise um GPT...">
          <button id="searchBtn" class="search-icon" aria-label="Buscar">🔍</button>
        </div>
        <button id="favoritesBtn">Favoritos</button>
      </div>
      <div id="categoryTabs" class="tabs"></div>
      <h2 id="sectionTitle" class="section-title">Categoria</h2>
    </div>
  </div>

  <!-- CONTEÚDO PRINCIPAL -->
  <div class="wrapper">
    <main class="main">
      <div id="content"></div>
    </main>
  </div>

  <!-- SCRIPTS -->
  <script src="js/app.js" defer></script>
</body>
</html>
