<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Redefinir senha | Clube do GPT</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #101828;
      font-family: 'Cinzel', serif;
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .reset-container {
      background: rgba(15,25,40,0.52);
      padding: 32px 36px;
      border-radius: 17px;
      box-shadow: 0 8px 32px 0 rgba(13,21,38,0.22);
      min-width: 310px;
      max-width: 97vw;
      text-align: center;
    }
    .reset-container h2 {
      color: #03b0ec;
      margin-bottom: 14px;
    }
    .reset-container input[type="password"] {
      width: 85%;
      padding: 12px 10px;
      border-radius: 7px;
      border: 1.3px solid #2bb5f9cc;
      margin-bottom: 18px;
      font-size: 1.09rem;
      font-family: 'Cinzel', serif;
    }
    .reset-container button {
      padding: 10px 32px;
      background: #03b0ec;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.05rem;
      font-family: 'Cinzel', serif;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.18s;
    }
    .reset-container button:hover {
      background: #0291c5;
    }
    .toast {
      background: #04b1f0;
      color: #fff;
      border-radius: 7px;
      padding: 13px 24px;
      margin: 20px auto 0 auto;
      display: none;
      max-width: 85vw;
    }
    .toast.show {
      display: block;
      animation: fadein 0.7s;
    }
    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="reset-container">
    <h2>Redefinir senha</h2>
    <form id="resetForm">
      <input type="password" id="senha1" placeholder="Nova senha" required><br>
      <input type="password" id="senha2" placeholder="Confirme a nova senha" required><br>
      <button type="submit">Redefinir</button>
    </form>
    <div id="toast" class="toast"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.42.5/dist/umd/supabase.min.js"></script>
  <script>
    // Configure com as suas chaves!
    const supabase = window.supabase.createClient(
      'https://fouqnyydrhxgadnxjtds.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZvdXFueXlkcmh4Z2FkbnhqdGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NjQyNDUsImV4cCI6MjA2ODA0MDI0NX0.JH2SFA-6itPBy_Vdnqm9wCmIw7m3BPHRlZkfcgaP-is'
    );

    // Toast simples
    function showToast(msg) {
      var t = document.getElementById('toast');
      t.textContent = msg;
      t.className = 'toast show';
      setTimeout(()=>{t.className='toast'}, 3500);
    }

    // Ao abrir a página, a URL já traz o token de recovery do Supabase!
    document.getElementById('resetForm').onsubmit = async function(e) {
      e.preventDefault();
      const senha1 = document.getElementById('senha1').value.trim();
      const senha2 = document.getElementById('senha2').value.trim();
      if (!senha1 || !senha2) {
        showToast('Preencha a nova senha nos dois campos.');
        return;
      }
      if (senha1 !== senha2) {
        showToast('As senhas não coincidem.');
        return;
      }
      // Atualiza a senha usando o Supabase (o usuário já está autenticado via token recovery)
      const { data, error } = await supabase.auth.updateUser({ password: senha1 });
      if (error) {
        showToast('Erro ao redefinir senha: ' + error.message);
        return;
      }
      showToast('Senha redefinida com sucesso! Faça login novamente.');
      setTimeout(()=>{ window.location = 'index.html'; }, 1900);
    };
  </script>
</body>
</html>
